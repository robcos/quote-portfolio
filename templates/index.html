<html>
<head>
<style>
  body {
    font-family: monospace;
    font-size: 12px;
  }
  .errorlist {
    display:inline;
    margin: 0;
    padding: 0;
  }
  .errorlist li {
    background-color: red;
    color: white;
    display: inline;
    font-size: 1em;
    margin: 0;
    padding: 2px;;
    text-align:left;
  }

  table {
    margin: 2em;
    border: 1px solid gray;
  }
  
  table caption {
    text-align:left;
  }

  th {
    text-align:right;
    white-space:nowrap;
  }
  .portfolio td {
    text-align:right;
    white-space:nowrap;
  }

  .negative {
    color: red;
  }
</style>
</style>
</head>
<body>
{% for portfolio in portfolios %}
<table border="1" class="portfolio">
<caption>Portfolio: {{portfolio.name}} ({{portfolio.currency}})</caption>
<tr>
<th>Symbol</th>
<th>Date</th>
<th>Price</th>
<th>Enter Date</th>
<th>Value</th>
<th>Local value</th>
<th>Cost</th>
<th>Gain</th>
<th>Gain %</th>
<th>Shares</th>
<th>RTR</th>
<th>Enter Price</th>
<th>Stop</th>
<th>ATR EXP 20</th>
<th>LL 10</th>
<th>Unit2</th>
<th>Should sell?</th>
</tr>

{% for position in portfolio.get_positions %}
<tr>
<td><a href="/edit/{{position.key}}">{{position.symbol}}</a></td>
<td>{{position.latest_quote.date}}</td>
<td>{{position.latest_quote.price|stringformat:'10.2f' }}</td>
<td>{{position.enter_date}}</td>
<td>{{ position.value|stringformat:'10.2f' }}</td>
<td>{{ position.local_value|stringformat:'10.2f' }}</td>
<td>{{ position.cost|stringformat:'10.2f' }}</td>
<td{% if position.loosing %} class="negative"{% endif %}>{{ position.gain|stringformat:'10.2f' }}</td>
<td>{{position.gainp|stringformat:'2.1f' }}%</td>
<td>{{position.shares }}</td>
<td>{{position.rtr}}</td>
<td>{{position.enter_price|stringformat:'10.2f' }}</td>
<td>{{position.stop|stringformat:'10.2f' }}</td>
<td>{{position.atr_exp_20|stringformat:'10.2f' }}</td>
<td>{{ position.ll_10|stringformat:'10.2f' }}</td>
<td>{{position.second_unit|stringformat:'10.2f' }}</td>
<td>{{position.should_sell}}</td>
</tr>
{% endfor %}
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>{{ portfolio.local_value|stringformat:'10.2f' }}</td>
<td>{{ portfolio.cost|stringformat:'10.2f' }}</td>
<td{% if portfolio.loosing %} class="negative"{% endif %}>{{ portfolio.gain|stringformat:'10.2f' }}</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

</table>
{% endfor %}
<table border=1>
<caption>Currencies</caption>
<tr>
<th>Symbol</th>
<th>Rate</th>
<th>Date</th>
</tr>
{% for currency in currencies %}
<tr>
<td>{{currency.symbol}}</td>
<td>{{currency.rate}}</td>
<td>{{currency.date}}</td>
</tr>
{% endfor %}
</table>

<form action="" method="POST">
<table border="0">
<caption>Add a new position</caption>
<tr class="fieldWrapper">
  <th><label for="id_portfolio">Portfolio</label></th>
  <td>{{ form.portfolio }} {{form.portfolio.errors}}</td>
</tr>
<tr class="fieldWrapper">
  <th><label for="id_symbol">Symbol</label></th>
  <td>{{ form.symbol }} {{form.symbol.errors}} {{form.non_field_errors}}</td>
</tr>
<tr class="fieldWrapper">
  <th><label for="id_shares">Shares</label></th>
  <td>{{ form.shares }} {{form.shares.errors}}</td>
</tr>
<tr class="fieldWrapper">
  <th><label for="id_enter_price">Enter price</label></th>
  <td>{{ form.enter_price }} {{form.enter_price.errors}}</td>
</tr>
<tr class="fieldWrapper">
  <th><label for="id_currency">Currency</label></th>
  <td>{{ form.currency }} {{form.currency.errors}}</td>
</tr>
<tr class="fieldWrapper">
  <th><label for="id_currency_rate">Currency rate</label></th>
  <td>{{ form.currency_rate }} {{form.currency_rate.errors}}</td>
</tr>
<tr class="fieldWrapper">
  <th><label for="id_enter_date">Enter date</label></th>
  <td>{{ form.enter_date }} {{form.enter_date.errors}}</td>
</tr>
<tr class="fieldWrapper">
  <th><label for="id_enter_commission">Enter commission</label></th>
  <td>{{ form.enter_commission }} {{form.enter_commission.errors}}</td>
</tr>
<tr><th></th>
<td><input type="submit" value="save"></td>
</form>
</body>
</html>
